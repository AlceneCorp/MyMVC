{% extends 'base.twig' %}

{% block content %}



<div class="container mt-4">
    <h1 class="h3 mb-4"><i class="fas fa-upload me-2"></i> Ajouter une image</h1>

    <form id="form-upload" enctype="multipart/form-data">
        <div class="mb-3">
            <label class="form-label">Titre</label>
            <input type="text" name="title" class="form-control" required>
        </div>
        <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea name="description" class="form-control"></textarea>
        </div>
        <div class="mb-3">
            <label class="form-label">Cat√©gorie</label>
            <input type="text" name="category" class="form-control">
        </div>
        <div class="mb-3">
            <label class="form-label">Fichier image</label>
            <input type="file" name="image" accept="image/*" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Enregistrer
        </button>
        <a href="{{ base_url }}/admin/gallery" class="btn btn-secondary">Annuler</a>
    </form>
</div>
{% endblock %}

{% block jquery %}
<script>
$('#form-upload').submit(function(e){
    e.preventDefault();
    let formData = new FormData(this);
    formData.append('_csrf', '{{ csrf_token }}');

    $.ajax({
        url: '{{ base_url }}/gallery/ajax/upload',
        method: 'POST',
        data: formData,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function(resp){
            if(resp.ok) {
                window.location.href = '{{ base_url }}/admin/gallery';
            } else {
                alert('Erreur: ' + (resp.error || 'Inconnue'));
            }
        }
    });
});
</script>
{% endblock %}
