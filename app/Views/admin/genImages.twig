{% extends 'base.twig' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        {% include 'admin/include/adminMenu.twig' %}

        <main class="col-md-12 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="text-center mb-4">
                    <i class="fas fa-wand-magic-sparkles me-2"></i> Générateur d'image par texte
                </h1>
            </div>

            <!-- Loader -->
            <div id="loading" class="text-center mt-4 d-none">
                <p><i class="fas fa-spinner fa-spin me-2"></i> Génération en cours...</p>
            </div>

            <!-- Résultat (image ou erreur) -->
            <div id="result" class="mt-4 text-center"></div>

            <form method="POST" action="/MyMVC/admin/genimages" id="generateForm">
                <div class="mb-3">
                    <label for="prompt" class="form-label fw-semibold">Texte (prompt) :</label>
                    <textarea 
                        id="prompt" 
                        name="prompt" 
                        rows="4" 
                        class="form-control" 
                        placeholder="Décris ce que tu souhaites générer...">{{ prompt|default('') }}</textarea>
                </div>

                <button type="submit" class="btn btn-primary" id="generateBtn">
                    <i class="fa-solid fa-wand-magic-sparkles me-2"></i> Générer
                </button>
            </form>

            
        </main>
    </div>
</div>
{% endblock %}

{% block jquery %}
<script>
$(function () 
{
    $('#generateForm').on('submit', function (e) 
    {
        e.preventDefault();

        const prompt = $('#prompt').val();
        const $btn = $('#generateBtn');
        const $loading = $('#loading');
        const $result = $('#result');

        $result.empty();
        $loading.removeClass('d-none');
        $btn.prop('disabled', true);

        $.post('/MyMVC/admin/genimages', { prompt: prompt }, function (data) 
        {
            $result.html(data);
        }).fail(function () 
        {
            $result.html('<div class="alert alert-danger">Une erreur est survenue.</div>');
        }).always(function () 
        {
            $loading.addClass('d-none');
            $btn.prop('disabled', false);
        });
    });
});
</script>
{% endblock %}
